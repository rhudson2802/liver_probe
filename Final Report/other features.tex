\section{Other Features}

\subsection{Temperature Sensor}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\linewidth]{temperature sensor.PNG}
	\caption{Temperature sensor circuit schematic.}
	\label{fig: temperature sensor}
\end{figure}

A thermistor based temperature sensor (figure \ref{fig: temperature sensor}) was included with the remote unit. This was to ensure that measurements could be calibrated for any temperature dependent effects which may be observed, and to measure the temperature within the autoclave. Because the remote unit will be packaged in a resin, it is unknown what the internal temperature will be when it is exposed to the heat of the autoclave. The temperature sensor allows this to be measured and to work out if it will cause any issues for the electronics. The Vishay NTCLG100E2103JB \cite{thermistor} thermistor was selected, which had a nominal resistance of \SI{10}{\kilo\ohm} at \SI{25}{\celsius}. This was placed in a Wheatstone bridge arrangement with three fixed \SI{10}{\kilo\ohm} resistors. When the thermistor was at room temperature, the voltage at each leg of the bridge was \SI{2.5}{\volt}, so there was no voltage difference across it. However, when the temperature of the thermistor changed, its resistance also changed leading to a voltage imbalance $\Delta v$ across the bridge. This voltage was fed to a differential amplifier, to yield an output signal which could be read by the PIC's ADC. The differential voltage $\Delta v$ is given by:\\

\begin{equation}
\Delta v = \frac{\delta R}{4 R}V
\end{equation}

where $\delta R$ is the change in resistance of the thermistor, and $R=\SI{10}{\kilo\ohm}$. The output voltage $v_o$ can then be calculated by summing the currents at the op-amp inputs, noting that for an ideal op-amp the inputs are at the same voltage. This gives:\\

\begin{equation}
v_o = 2 \frac{R_1}{R} \Delta v =R_1 \frac{\delta R}{2 R^2}V
\end{equation}

where $R_1$ is the value of feedback resistors R11 and R12, and $V=\SI{5}{\volt}$ is the supply voltage. Note that a \SI{2.5}{\volt} rail is used as a pseudo-ground for the non-inverting input. This is to allow the output to swing about \SI{2.5}{\volt}, which means that positive and negative $\Delta v$ will be amplified correctly.\\

The sensor was designed to have a range of \SIrange{5}{150}{\celsius}, to cover the minimum operating temperature of just below room temperature \SI{20}{\celsius} up to the maximum temperature of the autoclave, \SI{134}{\celsius} \cite{nhs_autoclave}. Using \SI{6.8}{\kilo\ohm} feedback resistors gave an output voltage of \SI{5}{\volt} at \SI{5}{\celsius} and \SI{0.831}{\volt} at \SI{150}{\celsius}. At the high range, the thermistor only gives a very small change in $\delta R$ per degree of temperature change, so the sensor will not have a large resolution at these temperatures. For example, the output voltage at \SI{145}{\celsius} is \SI{0.835}{\volt}. The PIC's ADC only has 10-bit resolution, so when operated from a \SI{5}{\volt} supply it will have a minimum voltage resolution of \SI{4.88}{\milli\volt}. This means that the temperature resolution will be just larger than \SI{5}{\celsius}. As the high range is used to understand the thermal properties of the device and not to calibrate the measurements, this resolution will be acceptable. In comparison, at room temperature the resolution is much greater (for example a \SI{0.423}{\volt} change as temperature decreases from \SIrange{25}{20}{\celsius}, giving a temperature resolution of \SI{0.058}{\celsius}).\\





\subsection{LCD}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\linewidth]{lcd.PNG}
	\caption{LCD interface circuitry.}
	\label{fig: lcd schematic}
\end{figure}

PICBASIC had a built-in command \verb|lcdout| which could be used to control an LCD with a Hitachi 44780 controller \cite{picbasic_pro}. To this end, an LCD module with an equivalent controller was selected. A 4x20 character matrix was desired to enable the screen to display all the information it required. The Displaytech 204-A-CC-BC-3LP \cite{lcd}. This used the Samsung KS0076B driver, which has an equivalent instruction set to the Hitachi 44780, meaning it can be controlled using the \verb|lcdout| command. Figure \ref{fig: lcd schematic} shows the LCD interface circuitry. The R/$\overline{\text{W}}$ pin was tied to ground, as the LCD only needed to be written to. $V_o$ set the operating voltage for the LCD, which in turn controlled the contrast of the display. The LCD datasheet recommended biasing this at \SI{0.2}{\volt}, but experimental results showed that the best contrast was achieved when $V_o$ was biased close to ground. Therefore, the optimum experimental bias voltage was implemented by a potential divider using the two closest standard resistor values, to give a bias of \SI{0.045}{\volt}. The remaining pins were data signals which were connected to PIC pins. The LCD could operate using either a 4- or 8-bit parallel interface \cite{picbasic_pro}. In this application, the 4-bit interface was selected to minimise the number of PIC pins which would be used by the LCD. The \verb|lcdout| command required that these 4 data signals were connected to either the upper or lower nybble of a single I/O port. Only PORTA\textless0:3\textgreater was suitable, as all the remaining ports had pins which were required for other functions, or unimplemented bits in the PORT.\\

The \verb|lcdout| command allowed simple control of the LCD. First, several \verb|define|s were set to configure the compiler. Then, commands could be written to the LCD by sending the byte \verb|$FE| before the corresponding command in the PICBASIC manual \cite{picbasic_pro} or LCD datasheet \cite{lcd}. Characters could be written by looking up the character code in the LCD's character map (specified in the datasheet \cite{lcd}) or by simply providing PICBASIC with the required string. A delay was required between each write operation to ensure the LCD was ready to receive another instruction, otherwise an error would occur. A simple program is included below:

\begin{lstlisting}
' Set LCD bus size (4 or 8 bits)
DEFINE LCD_BITS 4
' Set number of lines on LCD
DEFINE LCD_LINES 4
' Set command delay time in us
DEFINE LCD_COMMANDUS 1500
' Set data delay time in us
DEFINE LCD_DATAUS 44

LCD_DELAY con 1

'Need 10 second delay for LCD to boot
pause 500            
' Clear display move cursor to 2nd line 6th character
LCDOUT $FE, 1, $FE, $C0+6, "Welcome"         
pause LCD_DELAY
 ' Jump to third line 4th character
LCDOUT $FE, $94+4, "Liver Probe"                
\end{lstlisting}






\subsection{Memory}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.4\linewidth]{memory.PNG}
	\caption{EEPROM interface circuitry.}
	\label{fig: memory schematic}
\end{figure}

The EEPROM was designed to store a minimum of 1000 readings. Each reading had several components: the reading ID (1B), month (1B), day (1B), hour (1B), minute (1B), measurement value (2B), temperature reading (2B). This led to a total reading size of 9 bytes. This meant the memory required to store 1000 readings was $\SI{9}{\kilo\byte}=\SI{72}{\kilo\bit}$. The Microchip 24FC256-I/ST \cite{memory} was a \SI{256}{\kilo\bit} EEPROM chip which was selected. This will allow 3555 readings to be stored. The circuit in figure \ref{fig: memory schematic} was designed according to the data sheet \cite{memory} recommendations. The device communicated over an I\textsuperscript{2}C interface so it was connected to the PIC's SDA and SCL lines. It could have one of two addresses, which were set by the address pin A2. A \SI{10}{\kilo\ohm} pull-down resistor (R10) was used to pull this pin low. The resistor R9 is not placed, and is used to place an extra footprint on the PCB which would allow A2 to be pulled high if the designer desired.\\

The EEPROM chip was accessed using the PICBASIC \verb|i2cread| and \verb|i2cwrite| commands. The EEPROM allowed for sequential reads, so multiple bytes of data could be read out from one I\textsuperscript{2}C instruction, with the data saved in an array.\\





\subsection{Real Time Clock}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.5\linewidth]{rtc.PNG}
	\caption{RTC interface circuitry.}
	\label{fig: rtc schematic}
\end{figure}

The Microchip MCP7940N-I/SN \cite{rtc} was selected as the RTC module for the base unit. The circuit in figure \ref{fig: rtc schematic} was laid out according to the data sheet \cite{rtc} recommendations. A \SI{3}{\volt} CR2032 battery was used as a backup power supply for the module, to ensure the clock would continue timing even if the base power were removed. The module communicates over an I\textsuperscript{2}C interface, so it was connected to the PIC's SDA and SCL lines. The MFP output is not used.





\subsection{Buttons}
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\linewidth]{switches.jpg}
	\caption{Breakout board for push buttons.}
	\label{fig: buttons}
\end{figure}

The base unit required some buttons to interact with the menu. Four buttons were required, termed ``MENU'', ``OK'', ``UP'', and ``DOWN''. The 2-1825910-7 tactile switch \cite{buttons} available from Farnell was suitable, and was used with \SI{15}{\kilo\ohm} pull-up resistors. Due to a lack of available pins on the PIC, the ``OK'' and ``DOWN'' buttons were connected to the ``ICSPDAT'' and ``ICSPCLK'' lines respectively. These are used for in-circuit serial programming, and the inclusion of the switch circuits does not cause an issue because the pull-up resistor allows the programmer to take control of the line whenever it requires. The ``MENU'' button was initially connected to an external interrupt pin ``INT2'', but after testing was changed to the ``$\overline{\text{MCLR}}$'' pin. When in normal operation, the base unit spends most of its time listening for data coming from the remote unit. When the ``MENU'' button is pressed, however, the base unit should immediately transition to the menu screen. PICBASIC does not have a convenient method to interrupt the \verb|serin2| command, so the ``MENU'' button was changed to the ``$\overline{\text{MCLR}}$'' to hard reset the unit when the button was pressed. The buttons could be read by a simple digital read to the corresponding PIC pin. A breakout board (figure \ref{fig: buttons}) was designed for the buttons to be soldered to, which in turn could be mounted to the base unit's casing by screws and nuts.\\









