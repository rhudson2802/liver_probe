\section{Overall System}
\begin{figure}[htb]
	\centering
	\includegraphics[width=\linewidth]{flowchart.png}
	\caption{Flowchart for base unit firmware. Blue blocks indicate states, and green blocks indicate processes executed within these states.}
	\label{fig: flowchart}
\end{figure}

\begin{figure}[htb]
	\centering
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{menu screen.jpg}
		\caption{Menu screen}
		\label{fig: menu screen}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{take readings.jpg}
		\caption{Take readings screen}
		\label{fig: take readings screen}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{view readings.jpg}
		\caption{View readings screen}
		\label{fig: view readings screen}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{delete screen.jpg}
		\caption{Delete readings screen}
		\label{fig: delete readings screen}
	\end{subfigure}
	\caption{LCD screens for all four system states.}
	\label{fig: lcd screens}
\end{figure}

Figure \ref{fig: flowchart} shows the flowchart for the base unit's software. It has four states: ``menu'', ``take readings'', ``view readings, and ``delete readings''. Figure \ref{fig: lcd screens} shows what is displayed on the LCD for each state. The system boots up in the menu state, where the user navigates between the options by using the up and down buttons, and selects an option by pressing the OK button. Once an option is selected, the system moves to that state. The system will transition back to the menu state whenever the menu button is pressed, regardless of what the system is currently doing, because the menu button is connected to the $\overline{\text{MCLR}}$ hardware reset.\\

In the ``take readings'' state, the system listens for data from the remote unit, and when it picks up a valid data packet it will display it on the LCD. The system will compare the reading to a preset threshold for fatty/lean livers, and display this to the user. It will also display the current time and the remote unit's temperature.\\

In the ``view readings'' state, the system will initially display the two most recent data points stored in EEPROM along with the date and time that they were taken. By using the up and down buttons, the user can scroll through the readings stored in EEPROM.\\

In the ``delete readings'' state, the user is first asked to confirm that they do intend to delete all the readings stored in memory. If they press the OK button, then all the readings in the EEPROM will be cleared. If they press any other button, then the system will move back to the menu screen and not delete the readings.\\

The total price of the remote unit PCB and components was £17.49, and the price of the base unit was £33.66. These prices exclude the cost of resistors, capacitors, and wire as these were already available. The remote unit price is well below the £45 price requirement, so there is confidence that the NHS will see it as cost effective. The base is a little more expensive, but this is allowable since it will be reused, and fewer base units will need to be bought. The cost of the base enclosure (£9.46) must also be added, leading to a final overall system cost of £60.61. The price may be further reduced when the system moves to mass production, as this will allow cost savings when components are bought in bulk. Furthermore, the major cost of the PCB manufacture was the shipping (for instance the remote unit PCB cost £0.28 per unit but £3.78 for shipping). When large batch numbers of PCBs are made, the shipping cost per unit will reduce so they also become more economical per unit.
